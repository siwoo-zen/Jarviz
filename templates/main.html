{% extends "base.html" %}
{% load static %}

{% block title %}대시보드{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/main.css' %}">

<div class="container">
  <h1>환영합니다, {{ user.username }}님!</h1>

  {% if user.is_company %}
  <!-- ✅ 기업 사용자용 대시보드 -->
<div class="dashboard-summary">
  {% if job_posts %}
  <a href="{% url 'workhub:job_list' %}" class="card-link">
    <div class="card">📢 등록한 공고 수: {{ job_posts|length }}</div>
  </a>
  <a href="{% url 'workhub:job_list' %}" class="card-link">
    <div class="card">👥 전체 지원자 수: {{ applicant_count|default:"-" }}</div>
  </a>
  <a href="{% url 'workhub:job_list' %}" class="card-link">
    <div class="card">📈 공고 조회수: {{ total_views|default:"-" }}</div>
  </a>
  {% else %}
    <div class="card" style="flex: 1; text-align: center;">
      <p>등록한 공고가 없습니다.</p>
      <button class="employer-detail-btn" onclick="location.href='{% url 'workhub:job_create' %}'">공고 등록하기</button>
    </div>
  {% endif %}
  </div>
  <div class="data-charts">
    <div class="card">
      <h3>지원자 수 추이</h3>
      <p>[차트 영역]</p>
    </div>
    <div class="card">
      <h3>공고 클릭 수</h3>
      <p>[차트 영역]</p>
    </div>
  </div>

  <div class="domain-overview">
    <h3>채용공고 관리</h3>
    {% if job_posts %}
      <table>
        <thead>
          <tr>
            <th>공고명</th>
            <th>등록일</th>
            <th>마감일</th>
            <th>지원자 수</th>
            <th>관리</th>
          </tr>
        </thead>
        <tbody>
          {% for job in job_posts %}
            <tr>
              <td>
                <a href="{% url 'workhub:job_detail' job.pk %}" class="job-title-link">
                  {{ job.title }}
                </a>
              </td>
              <td>{{ job.created_at|date:"Y-m-d" }}</td>
              <td>{{ job.deadline|date:"Y-m-d" }}</td>
              <td>-</td>  <!-- 추후 지원자 수 연결 예정 -->
              <td>
                <a href="{% url 'workhub:job_edit' job.pk %}" class="job-edit-btn">수정하기</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>등록된 공고가 없습니다.</p>
    {% endif %}
  </div>


  {% else %}
  <!-- ✅ 지원자용 대시보드 -->
  <div class="dashboard-summary">
    <div class="card">
      {% if user.is_authenticated %}
        {% if resume %}
          <h3>내 이력서</h3>
          <p>{{ resume.title }}</p>
          <a href="{% url 'workhub:resume_edit' resume.id %}" class="resume-detail-btn">수정하기</a>
        {% else %}
          <h3>이력서 작성</h3>
          <p>아직 등록된 이력서가 없습니다.</p>
          <a href="{% url 'workhub:resume_create' %}" class="resume-detail-btn">이력서 작성하기</a>
        {% endif %}
      {% else %}
        <p><a href="{% url 'accounts:login' %}">로그인</a> 후 이력서를 작성하세요.</p>
      {% endif %}
    </div>       
    <div class="card">🔍 추천 공고 수: 4건</div>
    <div class="card">📝 최근 지원 내역: 2건</div>
  </div>

  <div class="data-charts">
    <div class="card">
      <h3>추천 채용공고</h3>
      <ul>
        <li>백엔드 개발자 - (기업A)</li>
        <li>AI 엔지니어 - (기업B)</li>
        <li>프론트엔드 인턴 - (기업C)</li>
      </ul>
    </div>
    <div class="card">
      <h3>최근 지원 히스토리</h3>
      <ul>
        <li>2025-04-29 - Java 개발자 (지원 완료)</li>
        <li>2025-04-27 - UI 디자이너 (검토 중)</li>
      </ul>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
